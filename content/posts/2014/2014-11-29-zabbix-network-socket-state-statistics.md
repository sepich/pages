---
title: Network socket state statistics monitoring by Zabbix
date: '2014-11-29T12:29:00.000+03:00'
tags:
- linux
- zabbix
modified: '2016-07-20T22:48:16.763+03:00'
thumbnail: /assets/img/2014/ss.png
url: /2014/11/zabbix-network-socket-state-statistics.html
---
It's strange that zabbix-agent lacks for information about network socket states. At least it would be nice to monitor number of `ESTAB`, `TIME_WAIT` and `CLOSE_WAIT` connections.
Good that we can extend zabbix-agent - so I made this:
![](/assets/img/2014/ss.png)

Installation:
1. Save this as `/etc/zabbix/zabbix_agentd.conf.d/ss.conf`:
   ```bash
   # Only UDP count returned on any sock[*] key query
   # All other items send to trap keys at the same time
   UserParameter=sock[*], /bin/ss -ant | grep -v State | awk 'BEGIN {s["CLOSE-WAIT"]=0;s["ESTAB"]=0;s["FIN-WAIT-1"]=0;s["FIN-WAIT-2"]=0;s["LAST-ACK"]=0;s["SYN-RECV"]=0;s["SYN-SENT"]=0;s["TIME-WAIT"]=0} {s[$$1]++} END {for (i in s) {print "- sock["i"]", s[i]}}' | /usr/bin/zabbix_sender -c /etc/zabbix/zabbix_agentd.conf -i - >/dev/null; /bin/ss -anu | wc -l
   ```
1. Import template with counters and graph  
[template_app_sockets.xml](https://github.com/sepich/zabbix/raw/master/templates/template_app_sockets.xml)

How it works:
- all counters have type `zabbix trapper`, but the `UDP` counter (which is active)
- when zabbix-agent asks for UDP connections count - all other counters will be sent to zabbix-server as traps at the same time
- you can adjust query interval which is by default 5 min


Quick theory:  
![](/assets/img/2014/tcp.gif)  
**LISTEN** - the local end-point is waiting for a connection request from a remote end-point i.e. a passive open was performed.
**SYN-SENT** - the first step of the three-way connection handshake was performed. A connection request has been sent to a remote end-point i.e. an active open was performed.  
**SYN-RECEIVED** - the second step of the three-way connection handshake was performed. An  acknowledgement for the received connection request as well as a  connection request has been sent to the remote end-point.  
**ESTABLISHED** - the third step of the three-way connection handshake was performed. The connection is open.  
**FIN-WAIT-1** - the first step of an active close (four-way handshake) was performed.  The local end-point has sent a connection termination request to the  remote end-point.  
**CLOSE-WAIT** - the local end-point has received a connection termination request and  acknowledged it e.g. OS knows that the remote application has closed the connection and waits for the local application to also do so.  
**FIN-WAIT-2** - the remote end-point has sent an acknowledgement for the previously sent  connection termination request. The local end-point waits for second FIN packet from the remote end-point.  
**LAST-ACK** - represents waiting for an acknowledgment of the connection termination request previously sent to the remote end-point   
**CLOSING** - the local end-point is waiting for an acknowledgement for a connection termination request before going to the TIME-WAIT state.  
**TIME-WAIT** - from the local end-point point of view, the connection is closed but  we’re still waiting before accepting a new connection in order to  prevent delayed duplicate packets from the previous connection from  being accepted by the new connection. [According to RFC 793 a connection can stay in TIME-WAIT for a maximum of four minutes known as a 2xMSL (maximum segment lifetime).]

Due to the way TCP/IP works, connections can not be closed immediately. When connection in one direction is  terminated, the other party can continue sending data in the other  direction. Packets may arrive out of order or be retransmitted after the connection has been closed. `CLOSE_WAIT` indicates that the remote endpoint (other side of the connection) has closed the connection. `TIME_WAIT` indicates that local endpoint (this side) has closed the connection. The connection is being kept around so that any delayed packets can be matched to the connection and handled appropriately. The connections will be removed when they time out within some time.

So, basically, we can tune sysctl timeouts to influence upon `TIME_WAIT`, but `CLOSE_WAIT` is an application decision (until `socket.close()` is not executed)

Comments imported from blogger:
<div class="comment"><img src="//resources.blogblog.com/img/blank.gif"/><a href="#">Anonymous</a> at <time datetime="2015-04-03T00:13:34.152+03:00">00:13, 03 April 2015</time>:<br/>
i&#39;ve got an error by importing the template in Zabbix 2.4<br />&quot; XML file contains fatal error 41:Specification mandate value for attribute data-pjax-transient [ Line: 32 | Column: 40 ]&quot;</div>
<div class="comment"><img src="//blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjPIpsFZxeXhwYiaSZFfaBPHaq47D5RjLrUTuKOI_W56xwu2EUEm5gpwBmn6mTlXeSGQMaEmVd4aZENpSrUZQxNXaELJA-QehvcCmMPoa7dXhqdTPW34s6syA1ZCo6yvsI/s1600/avatar.png"/><a href="https://www.blogger.com/profile/15219082553292373774">sepa</a> at <time datetime="2015-04-19T11:26:18.246+03:00">11:26, 19 April 2015</time>:<br/>
Unfortunately link for xml in post was pointing to conf file.<br />Fixed it, and checked that it still importing successfully to zabbix 2.4.3</div>
<div class="comment"><img src="//resources.blogblog.com/img/blank.gif"/><a href="#">Anonymous</a> at <time datetime="2015-05-05T18:48:00.127+03:00">18:48, 05 May 2015</time>:<br/>
Where do you change the interval? When item is set as trapper it has no interval - meaning this has to be set on the monitored server -- where exactly? Thx</div>
<div class="comment"><img src="//blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjPIpsFZxeXhwYiaSZFfaBPHaq47D5RjLrUTuKOI_W56xwu2EUEm5gpwBmn6mTlXeSGQMaEmVd4aZENpSrUZQxNXaELJA-QehvcCmMPoa7dXhqdTPW34s6syA1ZCo6yvsI/s1600/avatar.png"/><a href="https://www.blogger.com/profile/15219082553292373774">sepa</a> at <time datetime="2015-05-05T20:33:13.680+03:00">20:33, 05 May 2015</time>:<br/>
You set interval on the only one item of type &#39;monitoring agent&#39; which is uptime.<br />This check returns uptime and triggers sending of all the traps.</div>
<div class="comment"><img src="//resources.blogblog.com/img/blank.gif"/><a href="#">Anonymous</a> at <time datetime="2015-06-01T08:58:33.568+03:00">08:58, 01 June 2015</time>:<br/>
sorry but what is /bin/ss? on my server there isn&#39;t any such command. do i have to install any support packages?</div>
<div class="comment"><img src="//blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjPIpsFZxeXhwYiaSZFfaBPHaq47D5RjLrUTuKOI_W56xwu2EUEm5gpwBmn6mTlXeSGQMaEmVd4aZENpSrUZQxNXaELJA-QehvcCmMPoa7dXhqdTPW34s6syA1ZCo6yvsI/s1600/avatar.png"/><a href="https://www.blogger.com/profile/15219082553292373774">sepa</a> at <time datetime="2015-06-01T15:08:53.230+03:00">15:08, 01 June 2015</time>:<br/>
$ dpkg -S /bin/ss<br />iproute: /bin/ss<br />It is &#39;iproute&#39; package, i believed it was included in default debian</div>
<div class="comment"><img src="//resources.blogblog.com/img/blank.gif"/><a href="#">Anonymous</a> at <time datetime="2015-06-02T06:35:05.015+03:00">06:35, 02 June 2015</time>:<br/>
hello, it&#39;s me again. im on centos so the ss command is located in /usr/sbin/ss. therefore i&#39;ve modify the path in your script and it works well<br /><br />but another issue is that i couldn&#39;t make it work on my debian server, there&#39;s no data on the graph and i don&#39;t know y<br /><br />im sending u the log from zabbix_agent<br /><br /> 12360:20150601:234115.676 active checks #1 [processing active checks]<br /> 12360:20150601:234115.676 In process_active_checks() server:&#39;172.16.8.130&#39; port:10051)<br /> 12360:20150601:234115.676 In zbx_popen() command:&#39; /bin/ss -ant | grep -v State | awk &#39;BEGIN {s[&quot;CLOSE-WAIT&quot;]=0;s[&quot;ESTAB&quot;]=0;s[&quot;FIN-WAIT-1&quot;]=0;s[&quot;FIN-WAIT-2&quot;]=0;s[&quot;LAST-ACK&quot;]=0;s[&quot;SYN-RECV&quot;]=0;s[&quot;SYN-SENT&quot;]=0;s[&quot;TIME-WAIT&quot;]=0} {s[$1]++} END {for (i in s) {print &quot;- sock[&quot;i&quot;]&quot;, s[i]}}&#39; | /usr/bin/zabbix_sender -c /etc/zabbix/zabbix_agentd.conf -i - &gt;/dev/null; /bin/ss -anu | wc -l&#39;<br /> 12360:20150601:234115.676 End of zbx_popen():6<br /> 12362:20150601:234115.678 zbx_popen(): executing script<br /> 12360:20150601:234115.693 In zbx_waitpid()<br /> 12360:20150601:234115.693 zbx_waitpid() exited, status:0<br /> 12360:20150601:234115.693 End of zbx_waitpid():12362<br /> 12360:20150601:234115.693 EXECUTE_STR() command:&#39; /bin/ss -ant | grep -v State | awk &#39;BEGIN {s[&quot;CLOSE-WAIT&quot;]=0;s[&quot;ESTAB&quot;]=0;s[&quot;FIN-WAIT-1&quot;]=0;s[&quot;FIN-WAIT-2&quot;]=0;s[&quot;LAST-ACK&quot;]=0;s[&quot;SYN-RECV&quot;]=0;s[&quot;SYN-SENT&quot;]=0;s[&quot;TIME-WAIT&quot;]=0} {s[$1]++} END {for (i in s) {print &quot;- sock[&quot;i&quot;]&quot;, s[i]}}&#39; | /usr/bin/zabbix_sender -c /etc/zabbix/zabbix_agentd.conf -i - &gt;/dev/null; /bin/ss -anu | wc -l&#39; len:2 cmd_result:&#39;17&#39;<br /> 12360:20150601:234115.693 for key [sock[UDP]] received value [17]<br /> 12360:20150601:234115.694 In process_value() key:&#39;Zabbix server:sock[UDP]&#39; value:&#39;17&#39;<br /> 12360:20150601:234115.694 In send_buffer() host:&#39;172.16.8.130&#39; port:10051 values:0/100<br /> 12360:20150601:234115.694 End of send_buffer():SUCCEED<br /> 12360:20150601:234115.694 buffer: new element 0<br /> 12360:20150601:234115.694 End of process_value():SUCCEED<br /> 12360:20150601:234115.694 End of process_active_checks()<br /> 12360:20150601:234115.694 In get_min_nextcheck()<br /> 12360:20150601:234115.694 active checks #1 [idle 1 sec]<br /> 12356:20150601:234116.675 collector [processing data]</div>
<div class="comment"><img src="//blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjPIpsFZxeXhwYiaSZFfaBPHaq47D5RjLrUTuKOI_W56xwu2EUEm5gpwBmn6mTlXeSGQMaEmVd4aZENpSrUZQxNXaELJA-QehvcCmMPoa7dXhqdTPW34s6syA1ZCo6yvsI/s1600/avatar.png"/><a href="https://www.blogger.com/profile/15219082553292373774">sepa</a> at <time datetime="2015-06-02T22:19:38.490+03:00">22:19, 02 June 2015</time>:<br/>
So, it is successfully collecting active checks (UDP).<br />Everything else is sent as Traps.<br />What is the output of:<br />/bin/ss -ant | grep -v State | awk &#39;BEGIN {s[&quot;CLOSE-WAIT&quot;]=0;s[&quot;ESTAB&quot;]=0;s[&quot;FIN-WAIT-1&quot;]=0;s[&quot;FIN-WAIT-2&quot;]=0;s[&quot;LAST-ACK&quot;]=0;s[&quot;SYN-RECV&quot;]=0;s[&quot;SYN-SENT&quot;]=0;s[&quot;TIME-WAIT&quot;]=0} {s[$1]++} END {for (i in s) {print &quot;- sock[&quot;i&quot;]&quot;, s[i]}}&#39;<br /><br />And what is  the result of putting the previous output to:<br />/usr/bin/zabbix_sender -c /etc/zabbix/zabbix_agentd.conf -i -<br /><br />when you execute it on the server to be monitored? Maybe you don&#39;t have zabbix_sender installed or your zabbix_agent.conf is in another place.<br /></div>
<div class="comment"><img src="//resources.blogblog.com/img/blank.gif"/><a href="#">Anonymous</a> at <time datetime="2015-07-02T18:22:07.193+03:00">18:22, 02 July 2015</time>:<br/>
data appear to be sent to zabbix server, but not processed on server side.<br /><br />output of collecting command when run manually looks like this:<br />- sock[TIME-WAIT  0      0       ::ffff:XX.XX.XX.XX:80       ::ffff:176.106.193.50:52534 ] 1<br />- sock[ESTAB      0      0       ::ffff:XX.XX.XX.XX:80    ::ffff:77.120.168.85:59480 ] 1<br />- sock[TIME-WAIT  0      0       ::ffff:XX.XX.XX.XX:80     ::ffff:80.77.34.239:50050 ] 1<br />etc etc.<br /><br />output from sending collected data looks like this:<br />/usr/sbin/ss -ant | grep -v State | awk &#39;BEGIN {s[&quot;CLOSE-WAIT&quot;]=0;s[&quot;ESTAB&quot;]=0;s[&quot;FIN-WAIT-1&quot;]=0;s[&quot;FIN-WAIT-2&quot;]=0;s[&quot;LAST-ACK&quot;]=0;s[&quot;SYN-RECV&quot;]=0;s[&quot;SYN-SENT&quot;]=0;s[&quot;TIME-WAIT&quot;]=0} {s[$$1]++} END {for (i in s) {print &quot;- sock[&quot;i&quot;]&quot;, s[i]}}&#39; | /usr/bin/zabbix_sender -vv  -z ZZ.ZZ.ZZ.ZZ -s XX.XX.XX.XX -i -<br />zabbix_sender [21811]: DEBUG: answer [{<br />        &quot;response&quot;:&quot;success&quot;,<br />        &quot;info&quot;:&quot;processed: 0; failed: 250; total: 250; seconds spent: 0.002858&quot;}]<br />info from server: &quot;processed: 0; failed: 250; total: 250; seconds spent: 0.002858&quot;<br />zabbix_sender [21814]: DEBUG: answer [{<br />        &quot;response&quot;:&quot;success&quot;,<br />        &quot;info&quot;:&quot;processed: 0; failed: 250; total: 250; seconds spent: 0.002877&quot;}]<br />info from server: &quot;processed: 0; failed: 250; total: 250; seconds spent: 0.002877&quot;<br />etc etc<br /><br />any ideas?</div>
<div class="comment"><img src="//blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjPIpsFZxeXhwYiaSZFfaBPHaq47D5RjLrUTuKOI_W56xwu2EUEm5gpwBmn6mTlXeSGQMaEmVd4aZENpSrUZQxNXaELJA-QehvcCmMPoa7dXhqdTPW34s6syA1ZCo6yvsI/s1600/avatar.png"/><a href="https://www.blogger.com/profile/15219082553292373774">sepa</a> at <time datetime="2015-07-02T21:22:28.705+03:00">21:22, 02 July 2015</time>:<br/>
Please note that $ char is doubled in zabbix conf and if you want to run this command in shell you need to use single $. Check out my previous comment (s[$1]+). So correct output should be something like:<br />- sock[FIN-WAIT-2] 1<br />- sock[SYN-RECV] 0<br />- sock[CLOSE-WAIT] 1<br />- sock[LAST-ACK] 0<br />- sock[ESTAB] 2<br />- sock[TIME-WAIT] 3<br />- sock[LISTEN] 18<br />- sock[SYN-SENT] 0<br />- sock[FIN-WAIT-1] 0<br /></div>
<div class="comment"><img src="//resources.blogblog.com/img/blank.gif"/><a href="#">Anonymous</a> at <time datetime="2015-07-06T14:15:10.568+03:00">14:15, 06 July 2015</time>:<br/>
thanks. so, i fixed the 1st issue with double $, and now the output of collecting command run in shell looks exactly as it should:<br /><br />- sock[SYN-SENT] 0<br />- sock[LAST-ACK] 17<br />- sock[SYN-RECV] 8<br />- sock[ESTAB] 314<br />- sock[FIN-WAIT-1] 35<br />- sock[CLOSING] 6<br />- sock[FIN-WAIT-2] 162<br />- sock[TIME-WAIT] 2660<br />- sock[CLOSE-WAIT] 14<br />- sock[LISTEN] 21<br /><br />but it&#39;s still not processed on the server side:<br />${collecting_string_snipped} | /usr/bin/zabbix_sender -vv -z XX.XX.XX.XX -s YY.YY.YY.YY -i - <br />zabbix_sender [11169]: DEBUG: answer [{<br />        &quot;response&quot;:&quot;success&quot;,<br />        &quot;info&quot;:&quot;processed: 0; failed: 10; total: 10; seconds spent: 0.034376&quot;}]<br />info from server: &quot;processed: 0; failed: 10; total: 10; seconds spent: 0.034376&quot;<br />sent: 10; skipped: 0; total: 10<br /></div>
<div class="comment"><img src="//resources.blogblog.com/img/blank.gif"/><a href="#">Anonymous</a> at <time datetime="2015-07-06T14:48:38.934+03:00">14:48, 06 July 2015</time>:<br/>
can i check things from the zabbix server side somehow?<br />i&#39;m new to zabbix and still don&#39;t know how to check receiving multiple parameters.</div>
<div class="comment"><img src="//blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjPIpsFZxeXhwYiaSZFfaBPHaq47D5RjLrUTuKOI_W56xwu2EUEm5gpwBmn6mTlXeSGQMaEmVd4aZENpSrUZQxNXaELJA-QehvcCmMPoa7dXhqdTPW34s6syA1ZCo6yvsI/s1600/avatar.png"/><a href="https://www.blogger.com/profile/15219082553292373774">sepa</a> at <time datetime="2015-07-06T20:55:58.603+03:00">20:55, 06 July 2015</time>:<br/>
You&#39;ve already checked that by using zabbix_sender debug output. This line &quot;processed: 0; failed: 10; total: 10;&quot; means that on zabbix server side nobody listens for these values.<br />It is because you used &quot;-z XX.XX.XX.XX -s YY.YY.YY.YY&quot;  and there is no server with explicit name &#39;YY.YY.YY.YY&#39; configured on zabbix side.<br />Usually you installing zabbix agent and configuring it using config file. You setting servername there, not IP. And then configuring the same servername (or autodiscovery) on zabbix server side, and adding some items to check for this servername.</div>
<div class="comment"><img src="//resources.blogblog.com/img/blank.gif"/><a href="#">Anonymous</a> at <time datetime="2015-07-14T17:08:19.976+03:00">17:08, 14 July 2015</time>:<br/>
thanks for explanation. <br />now i&#39;ve fixed that, and getting the following:<br /><br /># /usr/sbin/ss -ant | grep -v State | awk &#39;BEGIN {s[&quot;CLOSE-WAIT&quot;]=0;s[&quot;ESTAB&quot;]=0;s[&quot;FIN-WAIT-1&quot;]=0;s[&quot;FIN-WAIT-2&quot;]=0;s[&quot;LAST-ACK&quot;]=0;s[&quot;SYN-RECV&quot;]=0;s[&quot;SYN-SENT&quot;]=0;s[&quot;TIME-WAIT&quot;]=0} {s[$1]++} END {for (i in s) {print &quot;- sock[&quot;i&quot;]&quot;, s[i]}}&#39; | /usr/bin/zabbix_sender -vvv  -z XX.XX.XX.XX -s ServerName -i - <br />zabbix_sender [19025]: DEBUG: answer [{<br />        &quot;response&quot;:&quot;success&quot;,<br />        &quot;info&quot;:&quot;processed: 9; failed: 1; total: 10; seconds spent: 0.000271&quot;}]<br />info from server: &quot;processed: 9; failed: 1; total: 10; seconds spent: 0.000271&quot;<br />sent: 10; skipped: 0; total: 10<br /><br />how could i check what&#39;s failed?</div>
<div class="comment"><img src="//resources.blogblog.com/img/blank.gif"/><a href="#">Anonymous</a> at <time datetime="2015-07-14T17:33:30.853+03:00">17:33, 14 July 2015</time>:<br/>
sorry, the previous output is wrong, since it did not send any data from the second command (/usr/sbin/ss -anu | wc -l).<br />now, when i send output of the whole string, i get:<br /><br />/usr/sbin/ss -ant | grep -v State | awk &#39;BEGIN {s[&quot;CLOSE-WAIT&quot;]=0;s[&quot;ESTAB&quot;]=0;s[&quot;FIN-WAIT-1&quot;]=0;s[&quot;FIN-WAIT-2&quot;]=0;s[&quot;LAST-ACK&quot;]=0;s[&quot;SYN-RECV&quot;]=0;s[&quot;SYN-SENT&quot;]=0;s[&quot;TIME-WAIT&quot;]=0} {s[$1]++} END {for (i in s) {print &quot;- sock[&quot;i&quot;]&quot;, s[i]}}&#39; ; /usr/sbin/ss -anu | wc -l | /usr/bin/zabbix_sender -vvv  -z XX.XX.XX.XX -s ServerName -i - <br />- sock[SYN-SENT] 3<br />- sock[LAST-ACK] 19<br />- sock[SYN-RECV] 131<br />- sock[ESTAB] 299<br />- sock[FIN-WAIT-1] 16<br />- sock[CLOSING] 2<br />- sock[FIN-WAIT-2] 141<br />- sock[TIME-WAIT] 2145<br />- sock[CLOSE-WAIT] 5<br />- sock[LISTEN] 25<br />zabbix_sender [12145]: Warning: [line 1] &#39;Key&#39; required<br />Sending failed.<br /></div>
<div class="comment"><img src="//blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjPIpsFZxeXhwYiaSZFfaBPHaq47D5RjLrUTuKOI_W56xwu2EUEm5gpwBmn6mTlXeSGQMaEmVd4aZENpSrUZQxNXaELJA-QehvcCmMPoa7dXhqdTPW34s6syA1ZCo6yvsI/s1600/avatar.png"/><a href="https://www.blogger.com/profile/15219082553292373774">sepa</a> at <time datetime="2015-07-15T22:47:40.900+03:00">22:47, 15 July 2015</time>:<br/>
1. To check this kind of issue:<br />&quot;processed: 9; failed: 1; total: 10;&quot;<br />Just send output to zabbix_sender line by line<br /><br />2. You don&#39;t need to include second command output for passing to zabbix_sender.<br />Idea is to use one active check to send multiple trap counters in bunch. So zabbix-agent asks script only for UDP connections count ant this value is returned in plain form. But in the background all other counters are send in bunch to zabbix-server as traps using zabbix_sender. This way load on server and agent is less than asking for each counter as active checks.</div>
<div class="comment"><img src="//www.blogger.com/img/blogger_logo_round_35.png"/><a href="https://www.blogger.com/profile/05515448915194329371">kostyana</a> at <time datetime="2016-06-11T12:56:35.409+03:00">12:56, 11 June 2016</time>:<br/>
&quot;Please note that $ char is doubled in zabbix conf and if you want to run this command in shell you need to use single $.&quot; <br /><br />I spent about 3 hours for debugging this issue, and then i read this comment=) Now i have only one word - FUUU (aka Блин, да как так-то? все уже написано до нас..) =)</div>
<div class="comment"><img src="//resources.blogblog.com/img/blank.gif"/><a href="#">Anonymous</a> at <time datetime="2016-11-30T18:02:44.336+03:00">18:02, 30 November 2016</time>:<br/>
Hmmm no data on server side and any related entry on zabbix_agent.log</div>
<div class="comment"><img src="//resources.blogblog.com/img/blank.gif"/><a href="#">Anonymous</a> at <time datetime="2016-12-14T04:14:52.635+03:00">04:14, 14 December 2016</time>:<br/>
I don&#39;t have such thing on my host  /usr/bin/zabbix_sender :/usr/bin/zabbix_sender: No such file or directory<br /><br />What should I use on the ss.conf file?<br />Thanks</div>
<div class="comment"><img src="//resources.blogblog.com/img/blank.gif"/><a href="#">Anonymous</a> at <time datetime="2016-12-14T23:23:58.269+03:00">23:23, 14 December 2016</time>:<br/>
On the Zabbix UI I can see under latest data /graph the UDP ports populating the graph min max average , the others are at 0.<br /><br />/usr/sbin/ss -ant | grep -v State | awk &#39;BEGIN {s[&quot;CLOSE-WAIT&quot;]=0;s[&quot;ESTAB&quot;]=0;s[&quot;FIN-WAIT-1&quot;]=0;s[&quot;FIN-WAIT-2&quot;]=0;s[&quot;LAST-ACK&quot;]=0;s[&quot;SYN-RECV&quot;]=0;s[&quot;SYN-SENT&quot;]=0;s[&quot;TIME-WAIT&quot;]=0} {s[$1]++} END {for (i in s) {print &quot;- sock[&quot;i&quot;]&quot;, s[i]}}&#39; | /usr/bin/zabbix_sender -vvv -z 10.10.20.190 -s ServerName -i - <br />zabbix_sender [17561]: DEBUG: answer [{&quot;response&quot;:&quot;success&quot;,&quot;info&quot;:&quot;processed: 0; failed: 9; total: 9; seconds spent: 0.000259&quot;}]<br />info from server: &quot;processed: 0; failed: 9; total: 9; seconds spent: 0.000259&quot;<br />sent: 9; skipped: 0; total: 9<br /><br /><br />local the info it is checked and correct<br /><br />/usr/sbin/ss -ant | grep -v State | awk &#39;BEGIN {s[&quot;CLOSE-WAIT&quot;]=0;s[&quot;ESTAB&quot;]=0;s[&quot;FIN-WAIT-1&quot;]=0;s[&quot;FIN-WAIT-2&quot;]=0;s[&quot;LAST-ACK&quot;]=0;s[&quot;SYN-RECV&quot;]=0;s[&quot;SYN-SENT&quot;]=0;s[&quot;TIME-WAIT&quot;]=0} {s[$1]++} END {for (i in s) {print &quot;- sock[&quot;i&quot;]&quot;, s[i]}}&#39;<br />- sock[SYN-SENT] 0<br />- sock[LAST-ACK] 0<br />- sock[SYN-RECV] 0<br />- sock[ESTAB] 7<br />- sock[FIN-WAIT-1] 0<br />- sock[FIN-WAIT-2] 1<br />- sock[TIME-WAIT] 29<br />- sock[CLOSE-WAIT] 1<br />- sock[LISTEN] 9<br /><br />What will be the next step for troubleshooting<br /></div>
<div class="comment"><img src="//resources.blogblog.com/img/blank.gif"/><a href="#">Anonymous</a> at <time datetime="2016-12-14T23:26:54.123+03:00">23:26, 14 December 2016</time>:<br/>
What you meant by use single $?<br />Thanks</div>
<div class="comment"><img src="//resources.blogblog.com/img/blank.gif"/><a href="#">Anonymous</a> at <time datetime="2016-12-15T00:18:25.337+03:00">00:18, 15 December 2016</time>:<br/>
Got this in the zabbix server logs -elevated the log level to debug-<br /><br />17077:20161214:161100.799 In zbx_popen() command:&#39; /usr/sbin/ss -ant | grep -v State | awk &#39;BEGIN {s[&quot;CLOSE-WAIT&quot;]=0;s[&quot;ESTAB&quot;]=0;s[&quot;FIN-WAIT-1&quot;]=0;s[&quot;FIN-WAIT-2&quot;]=0;s[&quot;LAST-ACK&quot;]=0;s[&quot;SYN-RECV&quot;]=0;s[&quot;SYN-SENT&quot;]=0;s[&quot;TIME-WAIT&quot;]=0} {s[21161]++} END {for (i in s) {print &quot;- sock[&quot;i&quot;]&quot;, s[i]}}&#39; | /usr/bin/zabbix_sender  -c /etc/zabbix/zabbix_agentd.conf -i - &gt;/dev/null; /usr/sbin/ss -anu | wc -l&#39;<br /> 17077:20161214:161100.800 End of zbx_popen():5<br /> 18704:20161214:161100.800 zbx_popen(): executing script<br /> 17077:20161214:161100.833 In zbx_waitpid()<br /> 17077:20161214:161100.833 zbx_waitpid() exited, status:0<br /> 17077:20161214:161100.833 End of zbx_waitpid():18704<br /> 17077:20161214:161100.833 EXECUTE_STR() command:&#39; /usr/sbin/ss -ant | grep -v State | awk &#39;BEGIN {s[&quot;CLOSE-WAIT&quot;]=0;s[&quot;ESTAB&quot;]=0;s[&quot;FIN-WAIT-1&quot;]=0;s[&quot;FIN-WAIT-2&quot;]=0;s[&quot;LAST-ACK&quot;]=0;s[&quot;SYN-RECV&quot;]=0;s[&quot;SYN-SENT&quot;]=0;s[&quot;TIME-WAIT&quot;]=0} {s[21161]++} END {for (i in s) {print &quot;- sock[&quot;i&quot;]&quot;, s[i]}}&#39; | /usr/bin/zabbix_sender  -c /etc/zabbix/zabbix_agentd.conf -i - &gt;/dev/null; /usr/sbin/ss -anu | wc -l&#39; len:2 cmd_result:&#39;22&#39;<br /> 17077:20161214:161100.833 for key [sock[UDP]] received value [22]<br /> 17077:20161214:161100.834 In process_value() key:&#39;rtpdl-ph-cmhs01:sock[UDP]&#39; value:&#39;22&#39;<br /> 17077:20161214:161100.834 In send_buffer() host:&#39;10.10.20.190&#39; port:10051 values:0/100<br /> 17077:20161214:161100.834 End of send_buffer():SUCCEED<br /> 17077:20161214:161100.834 buffer: new element 0<br /> 17077:20161214:161100.834 End of process_value():SUCCEED<br /> 17077:20161214:161100.834 End of process_active_checks()<br /> 17077:20161214:161100.834 In get_min_nextcheck()<br /> 17077:20161214:161100.834 active checks #1 [idle 1 sec]<br /> 17073:20161214:161101.792 collector [processing data]<br /> 17073:20161214:161101.793 In update_cpustats()<br /> 17073:20161214:161101.804 End of update_cpustats()<br /> 17073:20161214:161101.804 collector [idle 1 sec]<br /> 17077:20161214:161101.834 In send_buffer() host:&#39;10.10.20.190&#39; port:10051 values:1/100<br /> 17077:20161214:161101.835 JSON before sending [{&quot;request&quot;:&quot;agent data&quot;,&quot;data&quot;:[{&quot;host&quot;:&quot;rtpdl-ph-cmhs01&quot;,&quot;key&quot;:&quot;sock[UDP]&quot;,&quot;value&quot;:&quot;22&quot;,&quot;clock&quot;:1481749860,&quot;ns&quot;:834310726}],&quot;clock&quot;:1481749861,&quot;ns&quot;:834980670}]<br /> 17077:20161214:161101.836 JSON back [{&quot;response&quot;:&quot;success&quot;,&quot;info&quot;:&quot;processed: 1; failed: 0; total: 1; seconds spent: 0.000170&quot;}]<br /> 17077:20161214:161101.836 In check_response() response:&#39;{&quot;response&quot;:&quot;success&quot;,&quot;info&quot;:&quot;processed: 1; failed: 0; total: 1; seconds spent: 0.000170&quot;}&#39;<br /> 17077:20161214:161101.836 info from server: &#39;processed: 1; failed: 0; total: 1; seconds spent: 0.000170&#39;<br /> 17077:20161214:161101.837 End of check_response():SUCCEED<br /> 17077:20161214:161101.837 OK<br /> 17077:20161214:161101.837 End of send_buffer():SUCCEED<br /><br />Still why the close_wait or FIN_wait is not populated in graph</div>
